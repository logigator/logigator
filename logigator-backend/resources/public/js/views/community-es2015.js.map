{"version":3,"sources":["community-es2015.js"],"names":["community","pageType","document","querySelector","getAttribute","pageContainer","pageButtons","querySelectorAll","pageButtonTargets","searchTerm","currentPage","currentOrder","updatePagination","list","totalPages","Number","Bem","data","from","to","undefined","Math","max","page","i","forEach","button","index","disabled","setState","innerHTML","async","navigate","search","orderBy","params","searchParams","URLSearchParams","toString","resp","fetch","concat","text","baseUrl","location","protocol","host","pathname","join","window","history","pushState","addEventListener","hasState","searchInput","getElementById","debouncedListener","debounceFunction","value","addSearchListener","popularity","latest","classList","remove","add","addSortListener"],"mappings":"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","file":"community-es2015.js","sourcesContent":["function community() {\n\tconst pageType = document.querySelector('.view-community').getAttribute('data-type');\n\tconst pageContainer = document.querySelector('.view-community__list');\n\tconst pageButtons = document.querySelectorAll('.view-community__page-button');\n\tconst pageButtonTargets = [0, 0, 0, 0, 0, 0, 0];\n\n\tlet searchTerm;\n\tlet currentPage;\n\tlet currentOrder;\n\n\tfunction updatePagination() {\n\t\tconst list = document.querySelector('.partial-community-list');\n\t\tconst totalPages = Number(Bem.data(list, 'total-pages'));\n\t\tcurrentPage = Number(Bem.data(list, 'current-page'));\n\n\t\tpageButtonTargets[0] = currentPage > 0 ? 0 : undefined;\n\t\tpageButtonTargets[1] = currentPage > 0 ? currentPage - 1 : undefined;\n\n\t\tpageButtonTargets[2] = undefined;\n\t\tpageButtonTargets[3] = undefined;\n\t\tpageButtonTargets[4] = undefined;\n\n\t\tlet from;\n\t\tlet to;\n\t\tif (currentPage === 0) {\n\t\t\tfrom = 0;\n\t\t\tto = totalPages > 3 ? 3 : totalPages - 1;\n\t\t} else if (currentPage === totalPages - 1) {\n\t\t\tfrom = Math.max(totalPages - 3, 0);\n\t\t\tto = totalPages - 1;\n\t\t} else {\n\t\t\tfrom = currentPage - 1;\n\t\t\tto = currentPage + 1;\n\t\t}\n\t\tfor (let page = from, i = 2; page <= to; page++, i++) {\n\t\t\tpageButtonTargets[i] = page;\n\t\t}\n\n\t\tpageButtonTargets[5] = currentPage < totalPages - 1 ? currentPage + 1 : undefined;\n\t\tpageButtonTargets[6] = currentPage < totalPages - 1 ? totalPages - 1 : undefined;\n\n\n\t\tpageButtons.forEach((button, index) => {\n\t\t\tif (index <= 1 || index >= 5) {\n\t\t\t\tbutton.disabled = pageButtonTargets[index] === undefined;\n\t\t\t} else {\n\t\t\t\tBem.setState(button, 'hidden', pageButtonTargets[index] === undefined);\n\t\t\t\tBem.setState(button, 'active', pageButtonTargets[index] === currentPage);\n\t\t\t\tbutton.innerHTML = pageButtonTargets[index] + 1;\n\t\t\t}\n\t\t});\n\n\t}\n\n\tfunction addPageButtonListeners() {\n\t\tpageButtons.forEach((button, index) => {\n\t\t\tbutton.addEventListener('click', () => {\n\t\t\t\tif (pageButtonTargets[index] !== undefined && !Bem.hasState(button, 'active')) {\n\t\t\t\t\tnavigate(pageButtonTargets[index], searchTerm, currentOrder);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction addSearchListener() {\n\t\tconst searchInput = document.getElementById('view-community__search');\n\t\tconst debouncedListener = debounceFunction(() => {\n\t\t\tsearchTerm = searchInput.value;\n\t\t\tnavigate(0, searchTerm, currentOrder);\n\t\t}, 600);\n\t\tsearchInput.addEventListener('input', debouncedListener);\n\t}\n\n\tfunction addSortListener() {\n\t\tconst popularity = document.querySelector('.view-community__order-select > .popularity');\n\t\tconst latest = document.querySelector('.view-community__order-select > .latest');\n\n\t\tpopularity.addEventListener('click', () => {\n\t\t\tlatest.classList.remove('is-selected');\n\t\t\tpopularity.classList.add('is-selected');\n\t\t\tcurrentOrder = 'popularity';\n\t\t\tnavigate(currentPage, searchTerm, currentOrder);\n\t\t});\n\t\tlatest.addEventListener('click', () => {\n\t\t\tpopularity.classList.remove('is-selected');\n\t\t\tlatest.classList.add('is-selected');\n\t\t\tcurrentOrder = 'latest';\n\t\t\tnavigate(currentPage, searchTerm, currentOrder);\n\t\t});\n\t}\n\n\tasync function navigate(page, search, orderBy) {\n\t\tconst params = {\n\t\t\tpage\n\t\t};\n\t\tif (search !== undefined && search !== '') {\n\t\t\tparams.search = search;\n\t\t}\n\t\tif (orderBy !== undefined && orderBy !== '') {\n\t\t\tparams.orderBy = orderBy;\n\t\t}\n\n\t\tconst searchParams = new URLSearchParams(params).toString();\n\t\tconst resp = await fetch(`/community/${pageType}/page?${searchParams}`);\n\t\tpageContainer.innerHTML = await resp.text();\n\n\t\tconst baseUrl = [location.protocol, '//', location.host, location.pathname].join('');\n\t\twindow.history.pushState({}, '', baseUrl + '?' + searchParams);\n\t\tupdatePagination();\n\t}\n\n\tupdatePagination();\n\taddPageButtonListeners();\n\taddSearchListener();\n\taddSortListener();\n}\ncommunity();\n"]}