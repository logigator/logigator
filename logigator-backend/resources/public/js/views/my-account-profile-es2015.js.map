{"version":3,"sources":["my-account-profile-es2015.js"],"names":["imageChangeHandling","node","cropper","originalImageSrc","replaceImage","file","fileReader","FileReader","readAsDataURL","onload","readEvent","replace","target","result","document","addEventListener","e","popupNode","detail","querySelector","fileInput","Bem","element","uploadContainer","dragEvent","evt","state","preventDefault","stopPropagation","setState","click","event","dataTransfer","files","length","src","Cropper","aspectRatio","zoomable","toggleDragModeOnDblclick","dragMode","currentlySaving","getCroppedCanvas","imageSmoothingEnabled","imageSmoothingQuality","width","height","toBlob","async","formData","FormData","append","blob","fetch","method","body","ok","location","reload","setup"],"mappings":"AAAA,aAAA,SAASA,sBAER,IAAIC,EACAC,EACAC,EAoFJ,SAASC,EAAaC,GACrB,MAAMC,EAAa,IAAIC,WACvBD,EAAWE,cAAcH,GACzBC,EAAWG,OAASC,IACnBR,EAAQS,QAAQD,EAAUE,OAAOC,SAtFnCC,SAASC,iBAAiB,gBAAgBC,IACzC,MAAMC,EAAYD,EAAEE,OAAOC,cAAc,+BACpCF,IAGAhB,IACJA,EAAOgB,EAQT,WACC,MAAMG,EAAYC,IAAIC,QAAQrB,EAAM,QAC9BsB,EAAkBF,IAAIC,QAAQrB,EAAM,oBAuB1C,SAASuB,EAAUC,EAAKC,GACvBD,EAAIE,iBACJF,EAAIG,kBACJP,IAAIQ,SAASN,EAAiB,WAAYG,GAxB3CH,EAAgBR,iBAAiB,SAAS,IAAMK,EAAUU,UAC1DP,EAAgBR,iBAAiB,aAAaU,GAAOD,EAAUC,GAAK,KACpEF,EAAgBR,iBAAiB,aAAaU,GAAOD,EAAUC,GAAK,KACpEF,EAAgBR,iBAAiB,YAAYU,GAAOD,EAAUC,GAAK,KACnEF,EAAgBR,iBAAiB,WAAWU,GAAOD,EAAUC,GAAK,KAClEF,EAAgBR,iBAAiB,YAAYU,GAAOD,EAAUC,GAAK,KACnEF,EAAgBR,iBAAiB,aAAaU,GAAOD,EAAUC,GAAK,KACpEF,EAAgBR,iBAAiB,QAAQgB,IACxCA,EAAMJ,iBACNI,EAAMH,kBACNP,IAAIQ,SAASN,EAAiB,YAAY,GACtCQ,EAAMC,aAAaC,OACtB7B,EAAa2B,EAAMC,aAAaC,MAAM,OAGxCb,EAAUL,iBAAiB,UAAUgB,IAChCA,EAAMnB,OAAOqB,OAASF,EAAMnB,OAAOqB,MAAMC,OAAS,GACrD9B,EAAa2B,EAAMnB,OAAOqB,MAAM,OAUlC9B,EAAmBkB,IAAIC,QAAQrB,EAAM,OAAOkC,IAG5CjC,EAAU,IAAIkC,QAAQf,IAAIC,QAAQrB,EAAM,OAAQ,CAC/CoC,YAAa,EACbC,UAAU,EACVC,0BAA0B,EAC1BC,SAAU,SAGX,IAAIC,GAAkB,EACtBpB,IAAIC,QAAQrB,EAAM,QAAQc,iBAAiB,SAAS,KAC/C0B,IAEJA,GAAkB,EAClBvC,EAAQwC,iBAAiB,CACxBC,uBAAuB,EACvBC,sBAAuB,OACvBC,MAAO,IACPC,OAAQ,MACNC,QAAOC,MAAAA,IACT,MAAMC,EAAW,IAAIC,SACrBD,EAASE,OAAO,QAASC,UACNC,MAAM,mCAAoC,CAC5DC,OAAQ,OACRC,KAAMN,KAEEO,GACRC,SAASC,SAETrC,IAAIQ,SAASR,IAAIC,QAAQrB,EAAM,cAAe,QAAQ,KAGrD,iBAvEH0D,IAEGxD,GACHD,EAAQS,QAAQR,OAiFnBH","file":"my-account-profile-es2015.js","sourcesContent":["function imageChangeHandling() {\n\n\tlet node;\n\tlet cropper;\n\tlet originalImageSrc;\n\n\tdocument.addEventListener('popup-opened', e => {\n\t\tconst popupNode = e.detail.querySelector('.partial-change-image-popup');\n\t\tif (!popupNode) {\n\t\t\treturn;\n\t\t}\n\t\tif (!node) {\n\t\t\tnode = popupNode;\n\t\t\tsetup();\n\t\t}\n\t\tif (originalImageSrc) {\n\t\t\tcropper.replace(originalImageSrc);\n\t\t}\n\t});\n\n\tfunction setup() {\n\t\tconst fileInput = Bem.element(node, 'file');\n\t\tconst uploadContainer = Bem.element(node, 'upload-container');\n\n\t\tuploadContainer.addEventListener('click', () => fileInput.click());\n\t\tuploadContainer.addEventListener('dragstart', evt => dragEvent(evt, true));\n\t\tuploadContainer.addEventListener('dragenter', evt => dragEvent(evt, true));\n\t\tuploadContainer.addEventListener('dragover', evt => dragEvent(evt, true));\n\t\tuploadContainer.addEventListener('dragend', evt => dragEvent(evt, false));\n\t\tuploadContainer.addEventListener('dragexit', evt => dragEvent(evt, false));\n\t\tuploadContainer.addEventListener('dragleave', evt => dragEvent(evt, false));\n\t\tuploadContainer.addEventListener('drop', event => {\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t\tBem.setState(uploadContainer, 'dragging', false);\n\t\t\tif (event.dataTransfer.files) {\n\t\t\t\treplaceImage(event.dataTransfer.files[0]);\n\t\t\t}\n\t\t});\n\t\tfileInput.addEventListener('change', event => {\n\t\t\tif (event.target.files && event.target.files.length > 0) {\n\t\t\t\treplaceImage(event.target.files[0]);\n\t\t\t}\n\t\t});\n\n\t\tfunction dragEvent(evt, state) {\n\t\t\tevt.preventDefault();\n\t\t\tevt.stopPropagation();\n\t\t\tBem.setState(uploadContainer, 'dragging', state);\n\t\t}\n\n\t\toriginalImageSrc = Bem.element(node, 'img').src;\n\n\t\t// eslint-disable-next-line no-undef\n\t\tcropper = new Cropper(Bem.element(node, 'img'), {\n\t\t\taspectRatio: 1,\n\t\t\tzoomable: false,\n\t\t\ttoggleDragModeOnDblclick: false,\n\t\t\tdragMode: 'none'\n\t\t});\n\n\t\tlet currentlySaving = false;\n\t\tBem.element(node, 'save').addEventListener('click', () => {\n\t\t\tif (currentlySaving) return;\n\n\t\t\tcurrentlySaving = true;\n\t\t\tcropper.getCroppedCanvas({\n\t\t\t\timageSmoothingEnabled: true,\n\t\t\t\timageSmoothingQuality: 'high',\n\t\t\t\twidth: 256,\n\t\t\t\theight: 256\n\t\t\t}).toBlob(async blob => {\n\t\t\t\tconst formData = new FormData();\n\t\t\t\tformData.append('image', blob);\n\t\t\t\tconst resp = await fetch('/my/account/profile/update-image', {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tbody: formData\n\t\t\t\t});\n\t\t\t\tif (resp.ok) {\n\t\t\t\t\tlocation.reload();\n\t\t\t\t} else {\n\t\t\t\t\tBem.setState(Bem.element(node, 'save-error'), 'show', true);\n\n\t\t\t\t}\n\t\t\t}, 'image/png');\n\t\t});\n\t}\n\n\tfunction replaceImage(file) {\n\t\tconst fileReader = new FileReader();\n\t\tfileReader.readAsDataURL(file);\n\t\tfileReader.onload = readEvent => {\n\t\t\tcropper.replace(readEvent.target.result);\n\t\t};\n\t}\n\n}\nimageChangeHandling();\n"]}