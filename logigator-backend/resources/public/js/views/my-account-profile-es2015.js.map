{"version":3,"sources":["my-account-profile-es2015.js"],"names":["imageChangeHandling","node","cropper","originalImageSrc","replaceImage","file","fileReader","FileReader","readAsDataURL","onload","readEvent","replace","target","result","document","addEventListener","e","popupNode","detail","querySelector","fileInput","Bem","element","uploadContainer","dragEvent","evt","state","preventDefault","stopPropagation","setState","click","event","dataTransfer","files","length","src","Cropper","aspectRatio","zoomable","toggleDragModeOnDblclick","dragMode","currentlySaving","getCroppedCanvas","imageSmoothingEnabled","imageSmoothingQuality","width","height","toBlob","async","formData","FormData","append","blob","fetch","method","body","ok","location","reload","setup"],"mappings":"AAAA,aAAA,SAASA,sBAER,IAAIC,EACAC,EACAC,EAoFJ,SAASC,EAAaC,GACrB,MAAMC,EAAa,IAAIC,WACvBD,EAAWE,cAAcH,GACzBC,EAAWG,OAASC,IACnBR,EAAQS,QAAQD,EAAUE,OAAOC,SAtFnCC,SAASC,iBAAiB,gBAAgBC,IACzC,MAAMC,EAAYD,EAAEE,OAAOC,cAAc,+BACpCF,IAGAhB,IACJA,EAAOgB,EAQT,WACC,MAAMG,EAAYC,IAAIC,QAAQrB,EAAM,QAC9BsB,EAAkBF,IAAIC,QAAQrB,EAAM,oBAuB1C,SAASuB,EAAUC,EAAKC,GACvBD,EAAIE,iBACJF,EAAIG,kBACJP,IAAIQ,SAASN,EAAiB,WAAYG,GAxB3CH,EAAgBR,iBAAiB,SAAS,IAAMK,EAAUU,UAC1DP,EAAgBR,iBAAiB,aAAaU,GAAOD,EAAUC,GAAK,KACpEF,EAAgBR,iBAAiB,aAAaU,GAAOD,EAAUC,GAAK,KACpEF,EAAgBR,iBAAiB,YAAYU,GAAOD,EAAUC,GAAK,KACnEF,EAAgBR,iBAAiB,WAAWU,GAAOD,EAAUC,GAAK,KAClEF,EAAgBR,iBAAiB,YAAYU,GAAOD,EAAUC,GAAK,KACnEF,EAAgBR,iBAAiB,aAAaU,GAAOD,EAAUC,GAAK,KACpEF,EAAgBR,iBAAiB,QAAQgB,IACxCA,EAAMJ,iBACNI,EAAMH,kBACNP,IAAIQ,SAASN,EAAiB,YAAY,GACtCQ,EAAMC,aAAaC,OACtB7B,EAAa2B,EAAMC,aAAaC,MAAM,OAGxCb,EAAUL,iBAAiB,UAAUgB,IAChCA,EAAMnB,OAAOqB,OAASF,EAAMnB,OAAOqB,MAAMC,OAAS,GACrD9B,EAAa2B,EAAMnB,OAAOqB,MAAM,OAUlC9B,EAAmBkB,IAAIC,QAAQrB,EAAM,OAAOkC,IAG5CjC,EAAU,IAAIkC,QAAQf,IAAIC,QAAQrB,EAAM,OAAQ,CAC/CoC,YAAa,EACbC,UAAU,EACVC,0BAA0B,EAC1BC,SAAU,SAGX,IAAIC,GAAkB,EACtBpB,IAAIC,QAAQrB,EAAM,QAAQc,iBAAiB,SAAS,KAC/C0B,IAEJA,GAAkB,EAClBvC,EAAQwC,iBAAiB,CACxBC,uBAAuB,EACvBC,sBAAuB,OACvBC,MAAO,IACPC,OAAQ,MACNC,QAAOC,MAAAA,IACT,MAAMC,EAAW,IAAIC,SACrBD,EAASE,OAAO,QAASC,UACNC,MAAM,mCAAoC,CAC5DC,OAAQ,OACRC,KAAMN,KAEEO,GACRC,SAASC,SAETrC,IAAIQ,SAASR,IAAIC,QAAQrB,EAAM,cAAe,QAAQ,KAGrD,iBAvEH0D,IAEGxD,GACHD,EAAQS,QAAQR,OAiFnBH","file":"my-account-profile-es2015.js","sourcesContent":["function imageChangeHandling() {\r\n\r\n\tlet node;\r\n\tlet cropper;\r\n\tlet originalImageSrc;\r\n\r\n\tdocument.addEventListener('popup-opened', e => {\r\n\t\tconst popupNode = e.detail.querySelector('.partial-change-image-popup');\r\n\t\tif (!popupNode) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!node) {\r\n\t\t\tnode = popupNode;\r\n\t\t\tsetup();\r\n\t\t}\r\n\t\tif (originalImageSrc) {\r\n\t\t\tcropper.replace(originalImageSrc);\r\n\t\t}\r\n\t});\r\n\r\n\tfunction setup() {\r\n\t\tconst fileInput = Bem.element(node, 'file');\r\n\t\tconst uploadContainer = Bem.element(node, 'upload-container');\r\n\r\n\t\tuploadContainer.addEventListener('click', () => fileInput.click());\r\n\t\tuploadContainer.addEventListener('dragstart', evt => dragEvent(evt, true));\r\n\t\tuploadContainer.addEventListener('dragenter', evt => dragEvent(evt, true));\r\n\t\tuploadContainer.addEventListener('dragover', evt => dragEvent(evt, true));\r\n\t\tuploadContainer.addEventListener('dragend', evt => dragEvent(evt, false));\r\n\t\tuploadContainer.addEventListener('dragexit', evt => dragEvent(evt, false));\r\n\t\tuploadContainer.addEventListener('dragleave', evt => dragEvent(evt, false));\r\n\t\tuploadContainer.addEventListener('drop', event => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tBem.setState(uploadContainer, 'dragging', false);\r\n\t\t\tif (event.dataTransfer.files) {\r\n\t\t\t\treplaceImage(event.dataTransfer.files[0]);\r\n\t\t\t}\r\n\t\t});\r\n\t\tfileInput.addEventListener('change', event => {\r\n\t\t\tif (event.target.files && event.target.files.length > 0) {\r\n\t\t\t\treplaceImage(event.target.files[0]);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfunction dragEvent(evt, state) {\r\n\t\t\tevt.preventDefault();\r\n\t\t\tevt.stopPropagation();\r\n\t\t\tBem.setState(uploadContainer, 'dragging', state);\r\n\t\t}\r\n\r\n\t\toriginalImageSrc = Bem.element(node, 'img').src;\r\n\r\n\t\t// eslint-disable-next-line no-undef\r\n\t\tcropper = new Cropper(Bem.element(node, 'img'), {\r\n\t\t\taspectRatio: 1,\r\n\t\t\tzoomable: false,\r\n\t\t\ttoggleDragModeOnDblclick: false,\r\n\t\t\tdragMode: 'none'\r\n\t\t});\r\n\r\n\t\tlet currentlySaving = false;\r\n\t\tBem.element(node, 'save').addEventListener('click', () => {\r\n\t\t\tif (currentlySaving) return;\r\n\r\n\t\t\tcurrentlySaving = true;\r\n\t\t\tcropper.getCroppedCanvas({\r\n\t\t\t\timageSmoothingEnabled: true,\r\n\t\t\t\timageSmoothingQuality: 'high',\r\n\t\t\t\twidth: 256,\r\n\t\t\t\theight: 256\r\n\t\t\t}).toBlob(async blob => {\r\n\t\t\t\tconst formData = new FormData();\r\n\t\t\t\tformData.append('image', blob);\r\n\t\t\t\tconst resp = await fetch('/my/account/profile/update-image', {\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\tbody: formData\r\n\t\t\t\t});\r\n\t\t\t\tif (resp.ok) {\r\n\t\t\t\t\tlocation.reload();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tBem.setState(Bem.element(node, 'save-error'), 'show', true);\r\n\r\n\t\t\t\t}\r\n\t\t\t}, 'image/png');\r\n\t\t});\r\n\t}\r\n\r\n\tfunction replaceImage(file) {\r\n\t\tconst fileReader = new FileReader();\r\n\t\tfileReader.readAsDataURL(file);\r\n\t\tfileReader.onload = readEvent => {\r\n\t\t\tcropper.replace(readEvent.target.result);\r\n\t\t};\r\n\t}\r\n\r\n}\r\nimageChangeHandling();\r\n"]}