{"version":3,"sources":["my-account-profile-es5.js"],"names":["asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","this","args","arguments","apply","err","undefined","imageChangeHandling","node","cropper","originalImageSrc","replaceImage","file","fileReader","FileReader","readAsDataURL","onload","readEvent","replace","target","result","document","addEventListener","e","popupNode","detail","querySelector","fileInput","Bem","element","uploadContainer","dragEvent","evt","state","preventDefault","stopPropagation","setState","click","event","dataTransfer","files","length","src","Cropper","aspectRatio","zoomable","toggleDragModeOnDblclick","dragMode","currentlySaving","getCroppedCanvas","imageSmoothingEnabled","imageSmoothingQuality","width","height","toBlob","_ref","regeneratorRuntime","mark","_callee","blob","formData","wrap","_context","prev","next","FormData","append","fetch","method","body","sent","ok","location","reload","stop","_x","setup"],"mappings":"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","file":"my-account-profile-es5.js","sourcesContent":["function imageChangeHandling() {\n\n\tlet node;\n\tlet cropper;\n\tlet originalImageSrc;\n\n\tdocument.addEventListener('popup-opened', e => {\n\t\tconst popupNode = e.detail.querySelector('.partial-change-image-popup');\n\t\tif (!popupNode) {\n\t\t\treturn;\n\t\t}\n\t\tif (!node) {\n\t\t\tnode = popupNode;\n\t\t\tsetup();\n\t\t}\n\t\tif (originalImageSrc) {\n\t\t\tcropper.replace(originalImageSrc);\n\t\t}\n\t});\n\n\tfunction setup() {\n\t\tconst fileInput = Bem.element(node, 'file');\n\t\tconst uploadContainer = Bem.element(node, 'upload-container');\n\n\t\tuploadContainer.addEventListener('click', () => fileInput.click());\n\t\tuploadContainer.addEventListener('dragstart', evt => dragEvent(evt, true));\n\t\tuploadContainer.addEventListener('dragenter', evt => dragEvent(evt, true));\n\t\tuploadContainer.addEventListener('dragover', evt => dragEvent(evt, true));\n\t\tuploadContainer.addEventListener('dragend', evt => dragEvent(evt, false));\n\t\tuploadContainer.addEventListener('dragexit', evt => dragEvent(evt, false));\n\t\tuploadContainer.addEventListener('dragleave', evt => dragEvent(evt, false));\n\t\tuploadContainer.addEventListener('drop', event => {\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t\tBem.setState(uploadContainer, 'dragging', false);\n\t\t\tif (event.dataTransfer.files) {\n\t\t\t\treplaceImage(event.dataTransfer.files[0]);\n\t\t\t}\n\t\t});\n\t\tfileInput.addEventListener('change', event => {\n\t\t\tif (event.target.files && event.target.files.length > 0) {\n\t\t\t\treplaceImage(event.target.files[0]);\n\t\t\t}\n\t\t});\n\n\t\tfunction dragEvent(evt, state) {\n\t\t\tevt.preventDefault();\n\t\t\tevt.stopPropagation();\n\t\t\tBem.setState(uploadContainer, 'dragging', state);\n\t\t}\n\n\t\toriginalImageSrc = Bem.element(node, 'img').src;\n\n\t\t// eslint-disable-next-line no-undef\n\t\tcropper = new Cropper(Bem.element(node, 'img'), {\n\t\t\taspectRatio: 1,\n\t\t\tzoomable: false,\n\t\t\ttoggleDragModeOnDblclick: false,\n\t\t\tdragMode: 'none'\n\t\t});\n\n\t\tlet currentlySaving = false;\n\t\tBem.element(node, 'save').addEventListener('click', () => {\n\t\t\tif (currentlySaving) return;\n\n\t\t\tcurrentlySaving = true;\n\t\t\tcropper.getCroppedCanvas({\n\t\t\t\timageSmoothingEnabled: true,\n\t\t\t\timageSmoothingQuality: 'high',\n\t\t\t\twidth: 256,\n\t\t\t\theight: 256\n\t\t\t}).toBlob(async blob => {\n\t\t\t\tconst formData = new FormData();\n\t\t\t\tformData.append('image', blob);\n\t\t\t\tconst resp = await fetch('/my/account/profile/update-image', {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tbody: formData\n\t\t\t\t});\n\t\t\t\tif (resp.ok) {\n\t\t\t\t\tlocation.reload();\n\t\t\t\t} else {\n\t\t\t\t\tBem.setState(Bem.element(node, 'save-error'), 'show', true);\n\n\t\t\t\t}\n\t\t\t}, 'image/png');\n\t\t});\n\t}\n\n\tfunction replaceImage(file) {\n\t\tconst fileReader = new FileReader();\n\t\tfileReader.readAsDataURL(file);\n\t\tfileReader.onload = readEvent => {\n\t\t\tcropper.replace(readEvent.target.result);\n\t\t};\n\t}\n\n}\nimageChangeHandling();\n"]}